package dungeonSite;

import java.util.HashMap;
import java.util.Iterator;
import java.util.List;

import org.hibernate.Query;
import org.hibernate.Session;
import org.hibernate.SessionFactory;

public class UserDao 
{
	SessionFactory sessionFactory = HibernateUtil.getSessionFactory();
	Session session = sessionFactory.openSession();
	
	public void deleteByName(Session session, String username) 
	{
		System.out.println("Attempting to delete: " + username);
		User u = (User) session.get(User.class, username);
		session.beginTransaction();
		session.delete(u);
		session.getTransaction().commit();
	}
	
	public void deleteByID(Session session, Long id) 
	{
		System.out.println("Attempting to delete: " + id);
		User u = (User) session.get(User.class, id);
		session.beginTransaction();
		session.delete(u);
		session.getTransaction().commit();
	}
	
	public void update(Session session, User u) 
	{
		User temp = (User) session.get(User.class, u.getUserID());
		session.beginTransaction();
		session.saveOrUpdate(temp);
		session.getTransaction().commit();
	}
	
	public void create(Session session, User u) 
	{
		System.out.println("Submitting new User...");
		session.beginTransaction();
		session.save(u);
		session.getTransaction().commit();
	}
	
	public HashMap<Long,User> getAll(Session session) 
	{
		Query q = session.createQuery("FROM User");
		List<User> y = q.list();
		User temp;
		HashMap<Long,User> ret = new HashMap<Long,User>();
		System.out.println("Reading messages...");
		for (Iterator<User> iterator = y.iterator(); iterator.hasNext();) 
		{
			temp = iterator.next();
			ret.put(temp.getUserID(), temp);
		}
		return ret;
	}
}
